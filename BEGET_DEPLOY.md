# Инструкция по размещению приложения на хостинге Beget

## 1. Подготовка проекта для загрузки на сервер

### Файлы, которые должны быть в проекте:
- app.py - основной файл приложения Flask
- passenger_wsgi.py - конфигурационный файл для запуска через Passenger на Beget
- .htaccess - правила перенаправления запросов
- requirements.txt - список зависимостей проекта
- директории: templates, static, data и другие необходимые файлы

## 2. Настройка хостинга на Beget

### 2.1 Доступ по SSH
1. Войдите в личный кабинет Beget
2. Перейдите в раздел "SSH/FTP"
3. Создайте или получите данные для SSH-доступа
4. Подключитесь к серверу через SSH-клиент:
   ```
   ssh username@hostname
   ```

### 2.2 Создание виртуального окружения Python
```bash
cd ~/
mkdir -p python/venv
python3 -m venv python/venv
source python/venv/bin/activate
```

### 2.3 Установка проекта
1. Загрузите файлы проекта в корневую директорию вашего сайта на Beget через FTP или Git
2. Подключитесь к серверу через SSH
3. Перейдите в директорию проекта и установите зависимости:
   ```bash
   cd ~/site.ru/
   source ~/python/venv/bin/activate
   pip install -r requirements.txt
   ```

### 2.4 Настройка файла passenger_wsgi.py
Отредактируйте файл passenger_wsgi.py, указав корректный путь к вашему виртуальному окружению:
```python
INTERP = os.path.expanduser("/home/u/username/python/venv/bin/python3")
```
Замените `username` на ваше имя пользователя на Beget.

### 2.5 Настройка прав доступа
```bash
chmod 755 passenger_wsgi.py
chmod -R 777 data
```

### 2.6 Проверка работоспособности
1. Создайте директорию data, если она не существует:
   ```bash
   mkdir -p data
   chmod 777 data
   ```
   
2. Перезапустите приложение через панель управления Beget или командой:
   ```bash
   touch tmp/restart.txt
   ```

## 3. Дополнительные настройки

### 3.1 Настройка переменных окружения
Для установки переменных окружения на Beget добавьте их в файл .bashrc:
```bash
echo 'export SECRET_KEY="your_secret_key"' >> ~/.bashrc
echo 'export ALLOW_ALL_LOCATIONS="true"' >> ~/.bashrc
source ~/.bashrc
```

### 3.2 Настройка резервного копирования
В панели управления Beget настройте автоматическое резервное копирование для директории data.

### 3.3 Проверка работы планировщика
Для запуска планировщика резервного копирования воспользуйтесь сервисом Cron на Beget:
```bash
crontab -e
```

Добавьте следующую строку для ежедневного запуска резервного копирования:
```
0 3 * * * cd ~/site.ru && ~/python/venv/bin/python3 -c "from app import create_backup; create_backup()"
```

## 4. Решение возможных проблем

### 4.1 Ошибка 502 Bad Gateway
Если при запуске приложения вы получаете ошибку 502:
1. Проверьте логи в директории ~/logs/
2. Убедитесь, что все пути в passenger_wsgi.py указаны правильно
3. Проверьте установку всех зависимостей из requirements.txt

### 4.2 Проблемы с доступом к файлам
Если приложение не может записывать в директорию data:
```bash
chmod -R 777 data
```

### 4.3 Проблемы с кодировкой
Убедитесь, что все файлы сохранены в кодировке UTF-8 без BOM. 